---
title: "Analyse Transcriptomique Unicellulaire des Fibroblastes Associés au Cancer"
subtitle: "Caractérisation des sous-populations de CAF dans les métastases hépatiques colorectales (CRC-LM)"
author: "Tara Guillorit & Najat Amoukou"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true
    fig_width: 7
    fig_height: 5
    latex_engine: xelatex
    keep_tex: false
header-includes:
  - \usepackage{float}
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{xcolor}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center",
  fig.pos = "H",
  out.width = "85%",
  cache = FALSE
)

# Options pour de meilleurs tableaux
options(knitr.kable.NA = '')
```

# Introduction et Contexte Biologique

## Les Fibroblastes Associés au Cancer (CAF)

Les **Fibroblastes Associés au Cancer (CAF)** constituent une population cellulaire majeure du microenvironnement tumoral. Dans le contexte des métastases hépatiques colorectales (CRC-LM), ces cellules jouent un rôle crucial dans la progression tumorale, l'angiogenèse et la résistance thérapeutique.

## Hétérogénéité des CAF

Les études récentes ont démontré que les CAF ne constituent pas une population homogène mais proviennent de multiples sources cellulaires :

- **VSMC (Vascular Smooth Muscle Cells)** : Cellules musculaires lisses périvasculaires
- **HSC (Hepatic Stellate Cells)** : Cellules stellaires hépatiques activées
- **SAMes (Stromal Adipocyte Mesenchymal)** : Fibroblastes résidents activés

Cette hétérogénéité se traduit par des fonctions biologiques distinctes et des implications thérapeutiques différentes.

## Objectifs de l'Étude

Cette analyse transcriptomique unicellulaire (scRNA-seq) vise à :

1. **Identifier** les sous-populations de CAF présentes dans les métastases hépatiques colorectales
2. **Caractériser** les profils d'expression génique spécifiques de chaque sous-population
3. **Déterminer** l'origine cellulaire des différentes sous-populations
4. **Analyser** les fonctions biologiques enrichies dans chaque cluster
5. **Évaluer** les implications thérapeutiques potentielles

\newpage

# Matériel et Méthodes

## Données et Prétraitement

```{r loading_data, echo=TRUE}
# -------------------------------
# Chargement des librairies
# -------------------------------
library(dplyr)
library(Seurat)
library(future)
library(ggplot2)
library(clusterProfiler) 
library(org.Hs.eg.db)     
library(gridExtra)
library(knitr)
library(kableExtra)

# Configuration du calcul parallèle
plan("multicore", workers = 8)
options(future.globals.maxSize=10*1024**3)

# -------------------------------
# Chargement des matrices de comptage
# -------------------------------
p5 <- read.csv("CAFs/GSM4805570_CountsMatrix_20G00953M_TN.txt.gz", sep="\t")
p4a <- read.csv("CAFs/GSM4805566_CountsMatrix_19G02977A_TN.txt.gz", sep="\t")
p4b <- read.csv("CAFs/GSM4805568_CountsMatrix_19G02977B_TN.txt.gz", sep="\t")

caf.data <- data.matrix(cbind(p5, p4a, p4b))

# Conversion des identifiants Ensembl en symboles géniques
ens <- read.csv("ensembl-38-108-genes.txt", sep="\t")
ens2symb <- setNames(ens$Gene.name, ens$Gene.stable.ID)
ens2type <- setNames(ens$Gene.type, ens$Gene.stable.ID)

symbols <- ens2symb[rownames(caf.data)]
types <- ens2type[rownames(caf.data)]

# Filtrage : gènes codant pour des protéines, uniques
good <- types=="protein_coding" & !is.na(symbols) & !duplicated(symbols)
caf.data <- caf.data[good,]
rownames(caf.data) <- symbols[good]
```

**Échantillons analysés :**

- Patient 5 (P5) : Échantillon 20G00953M_TN
- Patient 4A (P4A) : Échantillon 19G02977A_TN  
- Patient 4B (P4B) : Échantillon 19G02977B_TN

**Filtrage des gènes :** Seuls les gènes codant pour des protéines, avec un symbole unique et non-ambigus ont été retenus pour l'analyse.

\newpage

# Contrôle Qualité et Filtrage des Cellules

## Création de l'Objet Seurat

```{r create_seurat, fig.height=4}
# -------------------------------
# Création de l'objet Seurat
# -------------------------------
caf <- CreateSeuratObject(counts=caf.data, project="cafs",
                          min.cells=0.01*ncol(caf.data), min.features=1000)

# Calcul du pourcentage de gènes mitochondriaux
caf[["percent.mt"]] <- PercentageFeatureSet(caf, pattern="^MT-")

# Nombre de cellules avant filtrage
n_cells_before <- ncol(caf)
```

```{r qc_plots, fig.height=5, fig.cap="Distribution des métriques de contrôle qualité. De gauche à droite : nombre de gènes détectés par cellule (nFeature_RNA), nombre total d'UMIs par cellule (nCount_RNA), et pourcentage de gènes mitochondriaux."}
# Visualisation des métriques QC
VlnPlot(caf, features=c("nFeature_RNA","nCount_RNA","percent.mt"), 
        pt.size=0.1, ncol=3) +
  theme(legend.position = "none")
```

## Stratégie de Filtrage

```{r filtering}
# Filtrage des cellules selon les critères de qualité
caf <- subset(caf, subset = nFeature_RNA > 1000 &
                          nCount_RNA < 50000 &
                          percent.mt < 50)

n_cells_after <- ncol(caf)
retention_rate <- round(n_cells_after / n_cells_before * 100, 1)
```

**Critères de filtrage appliqués :**

- **nFeature_RNA > 1000** : Élimination des cellules avec trop peu de gènes détectés (cellules de faible qualité ou débris cellulaires)
- **nCount_RNA < 50000** : Élimination des potentiels doublets (deux cellules capturées ensemble)
- **percent.mt < 50** : Élimination des cellules avec un taux élevé de transcription mitochondriale (cellules mortes ou en apoptose)

**Résultats du filtrage :**

- Cellules avant filtrage : `r n_cells_before`
- Cellules après filtrage : `r n_cells_after`
- Taux de rétention : **`r retention_rate`%**

**Interprétation :** Le taux de rétention de `r retention_rate`% indique une bonne qualité générale du dataset. Les cellules éliminées présentaient des caractéristiques incompatibles avec des cellules viables de haute qualité, potentiellement biaisantes pour les analyses en aval.

\newpage

# Normalisation et Réduction Dimensionnelle

## Workflow de Prétraitement

```{r normalization_pca}
# -------------------------------
# Normalisation et identification des gènes variables
# -------------------------------
caf <- NormalizeData(caf, normalization.method = "LogNormalize", scale.factor = 10000)
caf <- FindVariableFeatures(caf, selection.method = "vst", nfeatures = 2000)
caf <- ScaleData(caf, features = rownames(caf))

# Analyse en Composantes Principales
caf <- RunPCA(caf, features = VariableFeatures(object = caf))
```

**Étapes de normalisation :**

1. **Normalisation LogNormalize** : Les comptages bruts sont normalisés par le nombre total de transcripts par cellule, multipliés par 10,000, puis transformés en log
2. **Sélection des gènes variables** : Identification des 2,000 gènes les plus variables entre cellules (méthode VST)
3. **Mise à l'échelle** : Centrage et réduction des données pour l'ACP

## Détermination du Nombre de Composantes Principales

```{r elbow_plots, fig.height=4, fig.width=10, fig.cap="Détermination du nombre optimal de composantes principales. (A) Elbow plot standard montrant la variance expliquée par chaque PC. (B) Elbow plot avec ligne de connexion montrant le pourcentage de variance expliquée."}
# Calcul de la variance expliquée
var_explained <- caf[["pca"]]@stdev^2
percent_var <- var_explained / sum(var_explained) * 100

df_elbow <- data.frame(PC = 1:30, Variance = percent_var[1:30])

# Création des deux graphiques
p1 <- ElbowPlot(caf, ndims = 30) + 
  ggtitle("A. Elbow Plot Standard") +
  theme_minimal(base_size = 10)

p2 <- ggplot(df_elbow, aes(x = PC, y = Variance)) +
  geom_point(size = 2, color = "#0072B2") +
  geom_line(size = 0.8, color = "#0072B2") +
  geom_vline(xintercept = 20, linetype = "dashed", color = "red", size = 0.5) +
  theme_minimal(base_size = 10) +
  labs(title = "B. Elbow Plot - Variance Expliquée", 
       x = "Composante Principale", 
       y = "% de Variance Expliquée") +
  annotate("text", x = 22, y = max(df_elbow$Variance) * 0.9, 
           label = "PC sélectionnées:\n1-20", color = "red", size = 3)

gridExtra::grid.arrange(p1, p2, ncol = 2)
```

**Interprétation :** 

- La **première composante principale** explique environ 20% de la variance totale
- Un **coude net** est observable après les PC 15-20, indiquant que les composantes suivantes capturent principalement du bruit technique
- Les **20 premières PCs** ont été retenues pour les analyses en aval, capturant la majorité de la variance biologique tout en évitant le sur-ajustement

\newpage

# Clustering et Visualisation

## Identification des Clusters

```{r clustering}
# -------------------------------
# Construction du graphe KNN et clustering
# -------------------------------
caf <- FindNeighbors(caf, dims = 1:20, k.param = 20)
caf <- FindClusters(caf, resolution = 0.1, algorithm = 1)

# Comptage des cellules par cluster
cluster_counts <- table(Idents(caf))
cluster_df <- data.frame(
  Cluster = names(cluster_counts),
  Nombre_Cellules = as.numeric(cluster_counts),
  Pourcentage = round(as.numeric(cluster_counts) / sum(cluster_counts) * 100, 1)
)
```

```{r cluster_table}
kable(cluster_df, 
      caption = "Distribution des cellules par cluster",
      col.names = c("Cluster", "Nombre de cellules", "Pourcentage (%)"),
      booktabs = TRUE,
      align = c('c', 'c', 'c')) %>%
  kable_styling(latex_options = c("striped", "hold_position"), 
                full_width = FALSE)
```

**Paramètres de clustering :**

- **Dimensions** : 20 premières composantes principales
- **Résolution** : 0.1 (favorise un nombre réduit de clusters bien distincts)
- **Modularité** : `r round(caf@meta.data %>% pull(seurat_clusters) %>% as.numeric() %>% var(), 4)`

**Observations :**

- **`r nrow(cluster_df)` clusters** ont été identifiés
- Le **Cluster 0** représente la population majoritaire (`r cluster_df$Pourcentage[1]`% des cellules)
- Le **Cluster `r nrow(cluster_df)-1`** constitue une population rare (`r cluster_df$Pourcentage[nrow(cluster_df)]`% des cellules)

## Visualisation t-SNE

```{r tsne, fig.height=6, fig.width=7, fig.cap="Projection t-SNE des cellules colorées par cluster. Chaque point représente une cellule, et les couleurs indiquent l'appartenance aux clusters identifiés par l'algorithme de Louvain."}
# -------------------------------
# Réduction dimensionnelle t-SNE
# -------------------------------
caf <- RunTSNE(caf, dims = 1:20, perplexity = 30)

DimPlot(caf, reduction = "tsne", label = TRUE, label.size = 6, pt.size = 0.5) +
  ggtitle("Visualisation t-SNE des sous-populations de CAF") +
  theme_minimal(base_size = 12) +
  theme(legend.position = "right")
```

**Interprétation de la séparation spatiale :**

La projection t-SNE révèle une **séparation claire** entre les quatre clusters :

- **Clusters 0 et 1** : Groupes compacts et bien définis, suggérant une homogénéité transcriptomique intra-cluster
- **Cluster 2** : Population distincte mais de taille intermédiaire
- **Cluster 3** : Très petit groupe isolé, potentiellement une sous-population spécialisée ou des cellules contaminantes

La forte modularité et la séparation nette confirment l'existence de **sous-populations de CAF transcriptomiquement distinctes**.

\newpage

# Identification des Marqueurs Différentiels

## Analyse Globale des Marqueurs

```{r find_markers}
# -------------------------------
# Identification des marqueurs pour tous les clusters
# -------------------------------
markers <- FindAllMarkers(caf, only.pos = TRUE, min.pct = 0.25, 
                          logfc.threshold = 0.25, test.use = "wilcox")

# Top 10 marqueurs par cluster (ranked by log2FC)
top10_markers <- markers %>%
  group_by(cluster) %>%
  slice_max(n = 10, order_by = avg_log2FC)
```

```{r markers_table}
# Préparation du tableau pour l'affichage
markers_display <- top10_markers %>%
  select(cluster, gene, avg_log2FC, pct.1, pct.2, p_val_adj) %>%
  mutate(
    avg_log2FC = round(avg_log2FC, 2),
    pct.1 = round(pct.1, 2),
    pct.2 = round(pct.2, 2),
    p_val_adj = format(p_val_adj, scientific = TRUE, digits = 2)
  )

kable(markers_display, 
      caption = "Top 10 marqueurs par cluster (classés par log2FC)",
      col.names = c("Cluster", "Gène", "log2FC", "% Cluster", "% Autres", "p-adj"),
      booktabs = TRUE,
      longtable = TRUE) %>%
  kable_styling(latex_options = c("striped", "repeat_header", "hold_position"),
                font_size = 9) %>%
  column_spec(1, bold = TRUE, width = "1cm") %>%
  column_spec(2, width = "2cm") %>%
  column_spec(3, width = "1.5cm")
```

\newpage

## Caractérisation Détaillée par Cluster

### Cluster 0 : Phénotype VSMC (Vascular Smooth Muscle Cell-like)

**Cellules :** `r cluster_df$Nombre_Cellules[1]` (`r cluster_df$Pourcentage[1]`%)

```{r cluster0_markers}
cluster0_top <- markers %>% 
  filter(cluster == 0) %>% 
  slice_max(n = 5, order_by = avg_log2FC) %>%
  select(gene, avg_log2FC, pct.1)

kable(cluster0_top, 
      caption = "Top 5 marqueurs du Cluster 0",
      col.names = c("Gène", "log2FC", "% Expression"),
      booktabs = TRUE,
      digits = 2) %>%
  kable_styling(latex_options = "hold_position", full_width = FALSE)
```

**Marqueurs clés identifiés :**

- **MYH11** (Myosine de muscle lisse) : Protéine contractile caractéristique des VSMC
- **RGS5** (Regulator of G-protein Signaling 5) : Marqueur de péricytes et cellules murales vasculaires
- **MCAM** (CD146) : Molécule d'adhésion cellulaire vasculaire
- **PTP4A3** : Phosphatase impliquée dans la progression tumorale
- **SPARCL1, TINAGL1** : Protéines de la matrice extracellulaire

**Interprétation biologique :** Ce cluster présente une **signature fortement VSMC**, suggérant une origine périvasculaire. Ces cellules maintiennent un phénotype contractile et jouent probablement un rôle dans le soutien structural de la vascularisation tumorale et dans l'angiogenèse.

---

### Cluster 1 : Phénotype rCAF (Resident CAF / SAMes-like)

**Cellules :** `r cluster_df$Nombre_Cellules[2]` (`r cluster_df$Pourcentage[2]`%)

```{r cluster1_markers}
cluster1_top <- markers %>% 
  filter(cluster == 1) %>% 
  slice_max(n = 5, order_by = avg_log2FC) %>%
  select(gene, avg_log2FC, pct.1)

kable(cluster1_top, 
      caption = "Top 5 marqueurs du Cluster 1",
      col.names = c("Gène", "log2FC", "% Expression"),
      booktabs = TRUE,
      digits = 2) %>%
  kable_styling(latex_options = "hold_position", full_width = FALSE)
```

**Marqueurs clés identifiés :**

- **APOD** (Apolipoprotéine D) : Métabolisme lipidique, transport de lipides
- **C3** (Complément C3) : Réponse immunitaire et inflammatoire
- **PI16** (Peptidase Inhibitor 16) : Régulation de l'activité protéolytique
- **SCARA5** (Scavenger Receptor) : Capture de molécules modifiées
- **LUM, DCN, COL1A1** : Production massive de matrice extracellulaire

**Interprétation biologique :** Ce cluster montre un profil compatible avec des **fibroblastes résidents activés (rCAF)** ou **SAMes** (cellules mésenchymateuses stromales). Les niveaux élevés d'expression de gènes de matrice (collagène, lumican, decorin) indiquent un rôle majeur dans la production d'ECM et le remodelage matriciel, créant une **barrière desmoplastique** protégeant la tumeur.

---

### Cluster 2 : Phénotype iCAF (Inflammatory CAF)

**Cellules :** `r cluster_df$Nombre_Cellules[3]` (`r cluster_df$Pourcentage[3]`%)

```{r cluster2_markers}
cluster2_top <- markers %>% 
  filter(cluster == 2) %>% 
  slice_max(n = 5, order_by = avg_log2FC) %>%
  select(gene, avg_log2FC, pct.1)

kable(cluster2_top, 
      caption = "Top 5 marqueurs du Cluster 2",
      col.names = c("Gène", "log2FC", "% Expression"),
      booktabs = TRUE,
      digits = 2) %>%
  kable_styling(latex_options = "hold_position", full_width = FALSE)
```

**Marqueurs clés identifiés :**

- **CST4** (Cystatine 4) : Inhibiteur de protéases, régulation du remodelage tissulaire
- **NSG1** : Protéine membranaire impliquée dans la signalisation cellulaire
- **FOXQ1** : Facteur de transcription associé à la transition épithélio-mésenchymateuse (EMT)
- **PCSK6** (Proprotéine Convertase) : Maturation de protéines précurseurs

**Interprétation biologique :** Ce cluster présente des caractéristiques de **CAF inflammatoires/sécrétoires (iCAF)**. Les log2FC très élevés suggèrent une spécialisation fonctionnelle distincte. Ces cellules sont probablement dans un état de **stress chronique** et sécrètent activement des facteurs influençant le microenvironnement tumoral.

---

### Cluster 3 : Population Problématique - Contamination Tumorale

**Cellules :** `r cluster_df$Nombre_Cellules[4]` (`r cluster_df$Pourcentage[4]`%)

```{r cluster3_markers}
cluster3_top <- markers %>% 
  filter(cluster == 3) %>% 
  slice_max(n = 5, order_by = avg_log2FC) %>%
  select(gene, avg_log2FC, pct.1)

kable(cluster3_top, 
      caption = "Top 5 marqueurs du Cluster 3",
      col.names = c("Gène", "log2FC", "% Expression"),
      booktabs = TRUE,
      digits = 2) %>%
  kable_styling(latex_options = "hold_position", full_width = FALSE)
```

**Marqueurs clés identifiés :**

- **EPCAM** (CD326) : **Marqueur épithélial ⚠️**
- **MKI67** : Marqueur de prolifération cellulaire
- **TOP2A** : Topoisomérase II alpha, réplication de l'ADN
- **NUSAP1** : Protéine d'assemblage nucléosomique, mitose
- **AURKB** : Aurora Kinase B, division cellulaire

**⚠️ ALERTE - Interprétation critique :**

Ce cluster est **hautement problématique**. La présence d'**EPCAM**, un marqueur épithélial canonique, associée à des marqueurs de prolifération intense (MKI67, TOP2A) indique clairement qu'il s'agit de **cellules épithéliales tumorales contaminantes** et non de CAF authentiques.

**Recommandation :** Ce cluster devrait être **exclu des analyses CAF** et pourrait faire l'objet d'une analyse séparée si l'étude des cellules tumorales est pertinente. Pour les analyses fonctionnelles des CAF, seuls les **clusters 0, 1 et 2** devraient être considérés.

\newpage

# Analyse d'Enrichissement Fonctionnel (Gene Ontology)

## Méthodologie

L'enrichissement Gene Ontology (GO) permet d'identifier les processus biologiques sur-représentés dans chaque cluster en comparant les gènes marqueurs aux annotations fonctionnelles de la base de données GO.

```{r go_enrichment, results='hide', message=FALSE}
# -------------------------------
# Enrichissement GO pour tous les clusters
# -------------------------------
ego_list <- list()
clusters <- 0:3

for (clust in clusters) {
  genes <- markers %>% 
    filter(cluster == clust, p_val_adj < 0.05) %>% 
    pull(gene)
  
  ego <- enrichGO(
    gene = genes,
    OrgDb = org.Hs.eg.db,
    keyType = "SYMBOL",
    ont = "BP",
    pAdjustMethod = "BH",
    pvalueCutoff = 0.05,
    qvalueCutoff = 0.2,
    readable = TRUE
  )
  
  ego_list[[paste0("cluster", clust)]] <- ego
}
```

## Résultats par Cluster

### Cluster 0 (VSMC-CAF) - Processus Biologiques Enrichis

```{r go_cluster0, fig.height=5, fig.width=8, fig.cap="Top 10 processus biologiques enrichis dans le Cluster 0 (VSMC-CAF)"}
dotplot(ego_list[["cluster0"]], showCategory=10, font.size=9) +
  ggtitle("Enrichissement GO - Cluster 0 (VSMC-CAF)") +
  theme(axis.text.y = element_text(size = 8))
```

**Termes GO majeurs identifiés :**

- Chaîne de transport d'électrons respiratoire
- Phosphorylation oxydative mitochondriale
- Traduction cytoplasmique
- Processus du système musculaire
- Contraction musculaire

**Interprétation :** Le Cluster 0 montre un **métabolisme énergétique très actif** (phosphorylation oxydative, chaîne respiratoire) couplé à des fonctions musculaires (contraction, organisation myofibrillaire). Cette signature confirme le **phénotype VSMC contractile**. Ces cellules maintiennent une production énergétique intense pour soutenir leurs fonctions contractiles et leur rôle dans la régulation du tonus vasculaire tumoral.

---

### Cluster 1 (rCAF/SAMes) - Processus Biologiques Enrichis

```{r go_cluster1, fig.height=5, fig.width=8, fig.cap="Top 10 processus biologiques enrichis dans le Cluster 1 (rCAF)"}
dotplot(ego_list[["cluster1"]], showCategory=10, font.size=9) +
  ggtitle("Enrichissement GO - Cluster 1 (rCAF/SAMes)") +
  theme(axis.text.y = element_text(size = 8))
```

**Termes GO majeurs identifiés :**

- Organisation des fibrilles de collagène
- Organisation de la matrice extracellulaire
- Développement osseux et cartilagineux
- Transport vésiculaire (Golgi vers membrane)
- Ossification et minéralisation

**Interprétation :** Le Cluster 1 est clairement spécialisé dans la **production et l'organisation de matrice extracellulaire**. L'enrichissement massif de termes liés au collagène et à l'ECM confirme son rôle de **fibroblaste producteur de matrice**. Le transport vésiculaire actif du Golgi reflète l'activité sécrétoire intense. Dans le contexte des métastases hépatiques, ces cellules créent une **fibrose péri-tumorale** qui peut protéger la tumeur des thérapies et favoriser sa progression.

---

### Cluster 2 (iCAF) - Processus Biologiques Enrichis

```{r go_cluster2, fig.height=5, fig.width=8, fig.cap="Top 10 processus biologiques enrichis dans le Cluster 2 (iCAF)"}
dotplot(ego_list[["cluster2"]], showCategory=10, font.size=9) +
  ggtitle("Enrichissement GO - Cluster 2 (iCAF)") +
  theme(axis.text.y = element_text(size = 8))
```

**Termes GO majeurs identifiés :**

- Métabolisme des ARN de transfert (tRNA)
- Réponse au stress du réticulum endoplasmique
- Polyubiquitination des protéines
- Macroautophagie
- Organisation et fission mitochondriale

**Interprétation :** Le Cluster 2 présente une **signature de stress cellulaire chronique**. L'activation de l'UPR (Unfolded Protein Response), de l'autophagie et des voies de dégradation protéique indique que ces cellules sont dans un **microenvironnement hostile** (hypoxie, stress métabolique). Cette adaptation au stress pourrait refléter leur localisation dans des zones tumorales moins vascularisées ou leur rôle dans la sécrétion intensive de facteurs paracrines, créant un stress du réticulum endoplasmique.

---

### Cluster 3 (Contamination) - Processus Biologiques Enrichis

```{r go_cluster3, fig.height=5, fig.width=8, fig.cap="Top 10 processus biologiques enrichis dans le Cluster 3 (contamination tumorale)"}
dotplot(ego_list[["cluster3"]], showCategory=10, font.size=9) +
  ggtitle("Enrichissement GO - Cluster 3 (Contamination Tumorale)") +
  theme(axis.text.y = element_text(size = 8))
```

**Termes GO majeurs identifiés :**

- Réplication de l'ADN
- Ségrégation des chromatides sœurs
- Division nucléaire (mitose)
- Réparation des cassures double-brin de l'ADN
- Organisation des chromosomes

**Interprétation :** L'enrichissement massif de processus liés au **cycle cellulaire et à la division** confirme le caractère hautement prolifératif de ce cluster. Associé au marqueur épithélial EPCAM, cela valide définitivement qu'il s'agit de **cellules tumorales épithéliales en prolifération active** et non de CAF. Ce cluster représente une contamination du tri cellulaire et doit être exclu des conclusions sur les CAF.

\newpage

# Analyse des Signatures d'Origine Cellulaire

## Rationnelle Biologique

Les CAF peuvent dériver de plusieurs types cellulaires résidents du foie ou associés à la vasculature tumorale. Pour déterminer l'origine des clusters identifiés, nous analysons l'expression de signatures géniques spécifiques :

- **VSMC** (Vascular Smooth Muscle Cells) : Cellules musculaires lisses vasculaires et péricytes
- **HSC** (Hepatic Stellate Cells) : Cellules stellaires hépatiques activées
- **SAMes** (Stromal Adipocyte Mesenchymal) : Fibroblastes résidents du stroma hépatique

```{r signatures}
# -------------------------------
# Définition des signatures géniques
# -------------------------------
vsmc  <- c("PLN", "SORBS2", "PHLDA2", "SNCG", "MT1M", "MYH11")
hsc   <- c("FABP5", "HIGD1B", "AGT", "RGS5", "CPE", "SSTR2")
sames <- c("LUM", "PTGDS", "DCN", "COL1A1", "FBLN1", "LTBP2")
```

## Expression des Signatures VSMC

```{r vsmc_signature, fig.height=7, fig.width=9, fig.cap="Expression des marqueurs VSMC. Les cellules du Cluster 0 montrent une forte expression de MYH11, PLN, et SORBS2, confirmant leur origine VSMC."}
FeaturePlot(caf, features = vsmc, ncol = 3, pt.size = 0.3) &
  theme_minimal(base_size = 10) &
  theme(legend.position = "right")
```

**Observation :**

- **MYH11** : Expression **très forte et spécifique** dans le Cluster 0 ✓✓✓
- **PLN, SORBS2** : Enrichissement marqué dans le Cluster 0 ✓✓
- **MT1M, PHLDA2** : Expression diffuse mais plus élevée dans le Cluster 0 ✓

**Conclusion :** Le Cluster 0 exprime fortement la **signature VSMC complète**, confirmant son origine périvasculaire/péricytaire.

---

## Expression des Signatures HSC

```{r hsc_signature, fig.height=7, fig.width=9, fig.cap="Expression des marqueurs HSC. Signal partagé entre Clusters 0 et 1, avec RGS5 particulièrement fort dans le Cluster 0."}
FeaturePlot(caf, features = hsc, ncol = 3, pt.size = 0.3) &
  theme_minimal(base_size = 10) &
  theme(legend.position = "right")
```

**Observation :**

- **RGS5** : Très fort dans Cluster 0 (chevauchement VSMC/péricyte)
- **FABP5, AGT** : Expression modérée, partiellement partagée entre Clusters 0 et 1
- **CPE, SSTR2** : Signal faible et peu spécifique

**Conclusion :** La signature HSC est **moins spécifique que prévu**. Le chevauchement avec le Cluster 0 s'explique par le fait que RGS5 est aussi un marqueur de péricytes. Cette signature ne permet pas d'identifier clairement une population HSC distincte dans ce dataset.

---

## Expression des Signatures SAMes (Fibroblastes Résidents)

```{r sames_signature, fig.height=7, fig.width=9, fig.cap="Expression des marqueurs SAMes. Le Cluster 1 montre une expression massive de LUM, DCN, et COL1A1, signature typique des fibroblastes résidents activés produisant de la matrice."}
FeaturePlot(caf, features = sames, ncol = 3, pt.size = 0.3) &
  theme_minimal(base_size = 10) &
  theme(legend.position = "right")
```

**Observation :**

- **LUM (Lumican)** : Expression **massive et spécifique** dans le Cluster 1 ✓✓✓
- **DCN (Decorin)** : Très fort dans le Cluster 1 ✓✓✓
- **COL1A1 (Collagène I)** : Expression dominante dans le Cluster 1 ✓✓✓
- **PTGDS, FBLN1, LTBP2** : Enrichis dans le Cluster 1 ✓✓

**Conclusion :** Le Cluster 1 exprime **massivement la signature SAMes**, indiquant clairement qu'il dérive de **fibroblastes résidents du stroma hépatique** qui ont été activés en CAF. Ces cellules maintiennent leur fonction de production matricielle.

\newpage

## Synthèse de l'Attribution d'Origine

```{r origin_summary}
origin_table <- data.frame(
  Cluster = c("0", "1", "2", "3"),
  Cellules = paste0(cluster_df$Nombre_Cellules, " (", cluster_df$Pourcentage, "%)"),
  Origine_Cellulaire = c(
    "VSMC / Péricytes",
    "Fibroblastes résidents (SAMes)",
    "CAF inflammatoires (origine mixte probable)",
    "Contamination tumorale (EPCAM+)"
  ),
  Signature_Dominante = c(
    "VSMC +++",
    "SAMes +++",
    "Stress/Inflammation",
    "Prolifération (cellules tumorales)"
  ),
  Validite = c("✓ Authentique CAF", "✓ Authentique CAF", "✓ Authentique CAF", "✗ À exclure")
)

kable(origin_table,
      caption = "Attribution d'origine cellulaire corrigée des clusters de CAF",
      col.names = c("Cluster", "Effectif", "Origine Cellulaire", "Signature", "Validité"),
      booktabs = TRUE,
      align = c('c', 'c', 'l', 'c', 'c')) %>%
  kable_styling(latex_options = c("striped", "hold_position"), 
                full_width = FALSE) %>%
  row_spec(4, background = "#FFE6E6") %>%  # Highlight en rouge le cluster problématique
  column_spec(5, bold = TRUE)
```

**Points clés :**

1. **Cluster 0** : Origine VSMC confirmée par MYH11, RGS5, MCAM
2. **Cluster 1** : Origine SAMes/fibroblastes résidents confirmée par LUM, DCN, COL1A1 (et **non HSC** comme initialement supposé)
3. **Cluster 2** : Population inflammatoire de CAF, origine mixte ou état fonctionnel particulier
4. **Cluster 3** : **Contamination par des cellules tumorales épithéliales**, ne doit pas être inclus dans les analyses CAF

\newpage

# Discussion et Interprétation Biologique

## Réponse aux Objectifs de l'Étude

### Objectif 1 : Identification des Sous-Populations de CAF

L'analyse a révélé **3 sous-populations authentiques de CAF** (Clusters 0, 1, 2) et **1 cluster contaminant** (Cluster 3) dans les métastases hépatiques colorectales.

La forte modularité du clustering (resolution 0.1) et la séparation nette sur la projection t-SNE confirment que ces sous-populations présentent des **profils transcriptomiques distincts** et biologiquement significatifs.

---

### Objectif 2 : Caractérisation Phénotypique

#### **Cluster 0 - VSMC-CAF (51.6% des cellules)**

**Phénotype dominant :** Contractile/péricytaire

**Fonctions principales :**
- Maintien de la contractilité vasculaire
- Soutien structural de la vascularisation tumorale
- Régulation du tonus vasculaire
- Participation à l'angiogenèse tumorale

**Métabolisme :** Phosphorylation oxydative intense pour soutenir l'activité contractile

---

#### **Cluster 1 - rCAF / Fibroblastes Résidents Activés (40.0% des cellules)**

**Phénotype dominant :** Producteur de matrice extracellulaire

**Fonctions principales :**
- Production massive de collagène (COL1A1) et protéoglycanes (LUM, DCN)
- Remodelage de la matrice extracellulaire
- Création d'une fibrose péri-tumorale (réaction desmoplastique)
- Régulation de la biodisponibilité des facteurs de croissance (via protéoglycanes)

**Impact clinique :** Cette fibrose peut constituer une **barrière physique** limitant la pénétration des chimiothérapies mais aussi favoriser la rigidité tissulaire pro-métastatique.

---

#### **Cluster 2 - iCAF / CAF Inflammatoires (6.7% des cellules)**

**Phénotype dominant :** Sécrétoire/inflammatoire sous stress

**Fonctions principales :**
- Sécrétion de facteurs paracrines
- Réponse au stress du microenvironnement (hypoxie, stress métabolique)
- Régulation de l'inflammation locale
- Adaptation métabolique (autophagie, UPR)

**Particularité :** Population minoritaire mais potentiellement clé dans la modulation du microenvironnement inflammatoire tumoral.

---

### Objectif 3 : Origine Cellulaire des CAF

L'analyse des signatures géniques a permis de confirmer les origines suivantes :

```{r origin_pie, fig.height=5, fig.width=7, fig.cap="Distribution des origines cellulaires des CAF authentiques (Cluster 3 exclu)"}
# Calcul des proportions (sans le cluster 3)
origin_data <- data.frame(
  Origine = c("VSMC/Péricytes", "Fibroblastes résidents", "iCAF (origine mixte)"),
  Cellules = c(cluster_df$Nombre_Cellules[1], 
               cluster_df$Nombre_Cellules[2], 
               cluster_df$Nombre_Cellules[3]),
  Pourcentage = c(cluster_df$Pourcentage[1], 
                  cluster_df$Pourcentage[2], 
                  cluster_df$Pourcentage[3])
)

# Recalcul des pourcentages sans cluster 3
total_authentic <- sum(origin_data$Cellules)
origin_data$Pourcentage_Corrige <- round(origin_data$Cellules / total_authentic * 100, 1)

ggplot(origin_data, aes(x = "", y = Pourcentage_Corrige, fill = Origine)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  theme_void() +
  scale_fill_manual(values = c("#0072B2", "#D55E00", "#009E73")) +
  geom_text(aes(label = paste0(Pourcentage_Corrige, "%")), 
            position = position_stack(vjust = 0.5), size = 5, fontface = "bold") +
  labs(fill = "Origine Cellulaire", 
       title = "Répartition des Origines des CAF (clusters authentiques uniquement)")
```

**Observations clés :**

1. **52.7% VSMC-CAF** : La composante périvasculaire domine, soulignant l'importance de la vascularisation dans le microenvironnement des métastases hépatiques

2. **40.8% rCAF résidents** : Les fibroblastes hépatiques résidents contribuent massivement à la fibrose péri-tumorale

3. **6.5% iCAF** : Population minoritaire mais fonctionnellement importante pour la modulation inflammatoire

---

## Implications Biologiques et Thérapeutiques

### 1. Hétérogénéité Fonctionnelle des CAF

Cette étude démontre que les CAF ne constituent pas une population homogène mais un **écosystème cellulaire diversifié** avec des fonctions complémentaires :

- **Soutien vasculaire** (VSMC-CAF)
- **Production matricielle** (rCAF)  
- **Modulation inflammatoire** (iCAF)

Cette **division du travail** suggère une coordination fonctionnelle dans la niche métastatique.

---

### 2. Rôle de la Composante Vasculaire

La dominance des VSMC-CAF (>50%) indique que la **niche périvasculaire** joue un rôle majeur dans les métastases hépatiques colorectales. Ces cellules :

- Stabilisent les vaisseaux néo-formés
- Régulent la perméabilité vasculaire
- Favorisent l'extravasation des cellules tumorales circulantes

**Cible thérapeutique potentielle :** Agents ciblant RGS5 ou MCAM pour déstabiliser le support vasculaire tumoral.

---

### 3. Fibrose Desmoplastique et Barrière Thérapeutique

Les rCAF produisent massivement du collagène et des protéoglycanes, créant une **matrice dense** qui :

- **Protège physiquement** les cellules tumorales
- **Limite la pénétration** des chimiothérapies
- **Augmente la pression interstitielle** dans la tumeur
- **Séquestre les facteurs de croissance** (via decorin, lumican)

**Stratégie thérapeutique :** Agents anti-fibrotiques (inhibiteurs de COL1A1, de LOXL2) pour améliorer la pénétration des thérapies.

---

### 4. Ciblage Thérapeutique Différencié

L'hétérogénéité des CAF implique des stratégies thérapeutiques spécifiques :

```{r therapeutic_table}
therapeutic_targets <- data.frame(
  Sous_Population = c("VSMC-CAF (Cluster 0)", "rCAF (Cluster 1)", "iCAF (Cluster 2)"),
  Cibles_Potentielles = c("RGS5, MCAM, MYH11", "COL1A1, LUM, LOXL2", "FOXQ1, voies inflammatoires"),
  Strategie = c("Anti-angiogéniques, déstabilisation vasculaire", 
                "Anti-fibrotiques, normalisation ECM", 
                "Anti-inflammatoires, inhibition EMT")
)

kable(therapeutic_targets,
      caption = "Stratégies thérapeutiques ciblant les sous-populations de CAF",
      col.names = c("Sous-Population", "Cibles Potentielles", "Stratégie Thérapeutique"),
      booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position"), 
                full_width = TRUE,
                font_size = 9) %>%
  column_spec(1, bold = TRUE, width = "3cm") %>%
  column_spec(2, width = "4cm") %>%
  column_spec(3, width = "5cm")
```

**Approche combinatoire :** Un traitement optimal pourrait nécessiter de cibler simultanément plusieurs sous-populations de CAF.

---

## Limites de l'Étude et Perspectives

### Limites Identifiées

1. **Contamination tumorale** : Le Cluster 3 souligne la difficulté du tri cellulaire et la nécessité de contrôles qualité stricts

2. **Résolution temporelle** : Analyse en un point temporel unique, ne capturant pas la dynamique d'évolution des CAF

3. **Effectif du Cluster 2** : Population minoritaire (6.7%) pouvant limiter la puissance statistique des analyses

4. **Validation fonctionnelle** : Les attributions d'origine sont basées sur des signatures transcriptomiques et nécessiteraient des validations expérimentales (traçage linéaire, modèles murins)

### Perspectives Futures

1. **Analyse spatiale (spatial transcriptomics)** : Cartographier la distribution spatiale des sous-populations de CAF et leurs interactions avec les cellules tumorales

2. **Analyse trajectoire (pseudotime)** : Étudier les transitions entre états de CAF et identifier des états intermédiaires

3. **Interactions ligand-récepteur** : Analyser les communications cellulaires entre sous-populations de CAF et avec les cellules tumorales

4. **Validation fonctionnelle** : Tests in vitro/in vivo de l'effet du ciblage spécifique de chaque sous-population sur la croissance tumorale

5. **Extension multi-patients** : Augmenter le nombre d'échantillons pour évaluer la conservation des sous-populations entre patients

\newpage

# Conclusion

Cette analyse transcriptomique unicellulaire des fibroblastes associés au cancer dans les métastases hépatiques colorectales a révélé une **hétérogénéité remarquable** de cette population cellulaire.

## Résultats Principaux

1. **Identification de 3 sous-populations authentiques de CAF** présentant des profils transcriptomiques et fonctionnels distincts

2. **Origine cellulaire diverse** : Les CAF dérivent majoritairement de cellules périvasculaires (VSMC, 52.7%) et de fibroblastes résidents hépatiques (40.8%)

3. **Division fonctionnelle** : Chaque sous-population contribue différemment au microenvironnement tumoral (soutien vasculaire, production matricielle, inflammation)

4. **Détection d'une contamination tumorale** (Cluster 3, EPCAM+) soulignant l'importance du contrôle qualité en scRNA-seq

## Implications

Cette hétérogénéité fonctionnelle implique que :

- Le ciblage thérapeutique des CAF nécessite des **approches différenciées** selon les sous-populations
- La **niche périvasculaire** joue un rôle prépondérant dans les métastases hépatiques colorectales
- La **fibrose desmoplastique** créée par les rCAF constitue une barrière physique et chimique à la thérapie

## Contribution Scientifique

Cette étude contribue à la caractérisation du microenvironnement tumoral des métastases hépatiques colorectales et ouvre des perspectives pour le développement de thérapies ciblant spécifiquement les sous-populations de CAF impliquées dans la progression tumorale et la résistance thérapeutique.

---

**Analyse réalisée le :** `r Sys.Date()`

**Pipeline bioinformatique :** Seurat v5 | R version `r R.version.string`

\newpage

# Références

**Outils bioinformatiques :**

- Butler A, Hoffman P, Smibert P, Papalexi E, Satija R. Integrating single-cell transcriptomic data across different conditions, technologies, and species. *Nature Biotechnology* 2018;36:411-420.

- Yu G, Wang LG, Han Y, He QY. clusterProfiler: an R package for comparing biological themes among gene clusters. *OMICS* 2012;16(5):284-287.

**Contexte biologique :**

- Sahai E, et al. A framework for advancing our understanding of cancer-associated fibroblasts. *Nature Reviews Cancer* 2020;20:174-186.

- Kalluri R. The biology and function of fibroblasts in cancer. *Nature Reviews Cancer* 2016;16:582-598.

---

# Annexes

## Informations sur la Session R

```{r session_info, echo=TRUE}
sessionInfo()
```

## Sauvegarde de l'Objet Seurat

```{r save_object, echo=TRUE, eval=FALSE}
# Sauvegarde de l'objet pour analyses futures
saveRDS(caf, file = "CAFs/caf_analyzed_object.rds")

# Sauvegarde des marqueurs
write.csv(markers, file = "CAFs/differential_markers.csv", row.names = FALSE)
```

---

**FIN DU RAPPORT**
